{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    .dashboard-section {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 6px 30px rgba(16,24,40,0.06);
        padding: 28px 22px;
        margin-bottom: 28px;
    }
    .dashboard-header {
        font-size: 2.25rem;
        font-weight: 800;
        color: #1e40af;
        margin: 0;
        text-align: left;
        line-height: 1.05;
        letter-spacing: -0.4px;
    }
    .header-row { display:flex; align-items:center; justify-content:flex-start; gap:18px; margin-bottom:6px; padding-left:12px; }
    /* doctor icon in header */
    .header-icon { display:inline-flex; align-items:center; justify-content:center; width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,#eef2ff 0%, #ffffff 100%); box-shadow:0 4px 12px rgba(16,24,40,0.04); color:#1e40af; font-size:20px; }
    .dashboard-subtitle { text-align:left; color:#6b7280; margin-top:6px; font-size:0.95rem; }

    /* small pill spacing tweak so the brand feels attached to the title */
    .brand-pill { margin-left:0; }
    .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 18px;
        align-items: stretch;
    }
    .dashboard-card {
        background: #3b82f6;
        color: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(59,130,246,0.15);
        padding: 22px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        min-height: 140px;
        position: relative;
        overflow: hidden;
        transition: transform 0.12s;
    }
    .dashboard-card:hover { transform: translateY(-6px); }
    .dashboard-card .icon { display:flex; align-items:center; justify-content:center; width:48px; height:48px; border-radius:50%; background:rgba(255,255,255,0.12); font-size:22px; margin-bottom:12px; }
    .dashboard-card .card-title { font-size:1.15rem; font-weight:700; margin-bottom:6px; }
    .dashboard-card .card-text { font-size:0.97rem; margin-bottom:12px; opacity:0.95; }
    .dashboard-card .btn { background: #fff; color: #1e40af; font-weight:700; border-radius:8px; padding:8px 16px; box-shadow:0 2px 8px rgba(16,24,40,0.06); }
    .dashboard-card .btn:hover { background:#1e40af; color:#fff; }
    .dashboard-notifications {
        background: #fbfdff;
        border-radius: 12px;
        box-shadow: 0 4px 18px rgba(16,24,40,0.04);
        padding: 18px;
        margin-top: 20px;
    }
    .dashboard-notifications h3 {
        font-size: 1.05rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: #2563eb;
    }
    .dashboard-notifications ul {
        list-style: none;
        padding: 0;
    }
    .dashboard-notifications li {
        padding: 8px 0;
        font-size: 1rem;
        color: #333;
        border-bottom: 1px solid #e5e7eb;
    }
    .dashboard-notifications li:last-child {
        border-bottom: none;
    }
    .availability-table {
        width: 100%;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(45,108,223,0.08);
        margin-top: 32px;
        overflow-x: auto;
    }
    .availability-table th, .availability-table td {
        padding: 10px;
        text-align: left;
    }
    .availability-table th {
        background: #2d6cdf;
        color: #fff;
    }
    .availability-table tr {
        background: #f9fafb;
    }
    .availability-table tr:hover {
        background: #e1f5fe;
    }
    
    /* Responsive design for analytics grid */
    @media (max-width: 768px) {
        .analytics-grid {
            grid-template-columns: 1fr !important;
            gap: 16px !important;
        }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {
        .analytics-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    
    /* Quick action button hover effects */
    .quick-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-color: #cbd5e1;
    }
</style>

<div class="dashboard-section">
    <div class="header-row">
        <div class="header-icon"><i class='bx bx-user'></i></div>
        <div>
            <div class="dashboard-header">Doctor Dashboard</div>
            <div class="dashboard-subtitle">Manage appointments, patients and AI predictions from one place</div>
        </div>
    </div>
    <!-- Quick Analytics Cards -->
    <div class="analytics-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 28px;">
        <div class="analytics-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 1px solid #bae6fd; border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 800; color: #0369a1; margin-bottom: 4px;">{{ total_patients|default:"0" }}</div>
            <div style="color: #64748b; font-size: 0.9rem; font-weight: 600;">Total Patients</div>
            <div style="color: #0369a1; font-size: 0.8rem; margin-top: 4px;">
                <i class='bx bx-user'></i> Active Cases
            </div>
        </div>
        <div class="analytics-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 1px solid #bbf7d0; border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 800; color: #166534; margin-bottom: 4px;">{{ todays_appointments_count|default:"0" }}</div>
            <div style="color: #64748b; font-size: 0.9rem; font-weight: 600;">Today's Appointments</div>
            <div style="color: #166534; font-size: 0.8rem; margin-top: 4px;">
                <i class='bx bx-calendar-check'></i> Scheduled
            </div>
        </div>
        <div class="analytics-card" style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); border: 1px solid #c084fc; border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 800; color: #7c3aed; margin-bottom: 4px;">{{ pending_requests|default:"0" }}</div>
            <div style="color: #64748b; font-size: 0.9rem; font-weight: 600;">Pending Requests</div>
            <div style="color: #7c3aed; font-size: 0.8rem; margin-top: 4px;">
                <i class='bx bx-clock'></i> Awaiting
            </div>
        </div>
    </div>

    <div class="dashboard-cards">
        <div class="dashboard-card" style="background: #3b82f6;">
            <div class="icon"><i class='bx bx-calendar'></i></div>
            <div class="card-title">Appointments</div>
            <div class="card-text">View and manage your upcoming appointments with patients.</div>
            <a href="/doctors/appointments/" class="btn">View Appointments</a>
        </div>
        <div class="dashboard-card" style="background: #10b981;">
            <div class="icon"><i class='bx bx-user-plus'></i></div>
            <div class="card-title">Smart Patient Records</div>
            <div class="card-text">Access patient records, AI predictions, and add medical notes.</div>
            <a href="/doctors/patients/" class="btn">View Patients</a>
        </div>
        <div class="dashboard-card" style="background: #8b5cf6;">
            <div class="icon"><i class='bx bx-chat'></i></div>
            <div class="card-title">Patient Chat</div>
            <div class="card-text">Chat with patients from accepted appointments.</div>
            <a href="{% url 'doctors:chat' %}" class="btn">Open Chat</a>
        </div>
    </div>
    <div class="dashboard-notifications">
        <h3><i class='bx bx-activity'></i> Recent Activity & Quick Actions</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
            <!-- Recent Appointments -->
            <div style="background: #f8fafc; border-radius: 8px; padding: 16px;">
                <h4 style="color: #1e40af; font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <i class='bx bx-calendar-check'></i> Recent Appointments
                </h4>
                <div style="max-height: 160px; overflow-y: auto;">
                    {% if recent_appointments %}
                        {% for appointment in recent_appointments %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
                            <div>
                                <div style="font-weight: 600; color: #1e293b; font-size: 0.9rem;">{{ appointment.patient.user.first_name }} {{ appointment.patient.user.last_name }}</div>
                                <div style="color: #64748b; font-size: 0.8rem;">{{ appointment.date|date:"M d, Y" }} at {{ appointment.time|time:"g:i A" }}</div>
                            </div>
                            <div style="text-align: right;">
                                {% if appointment.status == 'completed' %}
                                    <div style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">Completed</div>
                                {% elif appointment.status == 'confirmed' %}
                                    <div style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">Confirmed</div>
                                {% else %}
                                    <div style="background: #fef3c7; color: #d97706; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">Pending</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div style="color: #94a3b8; font-style: italic; text-align: center; padding: 20px;">No recent appointments</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div style="background: #f8fafc; border-radius: 8px; padding: 16px;">
                <h4 style="color: #059669; font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <i class='bx bx-lightning'></i> Quick Actions
                </h4>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="/doctors/availability/" class="quick-action-btn" style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #fff; border-radius: 8px; text-decoration: none; color: #1e293b; border: 1px solid #e2e8f0; transition: all 0.2s;">
                        <div style="background: #dbeafe; color: #1e40af; padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px;">
                            <i class='bx bx-time'></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Manage Availability</div>
                            <div style="color: #64748b; font-size: 0.8rem;">Set your schedule</div>
                        </div>
                    </a>
                    <a href="/doctors/patients/" class="quick-action-btn" style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #fff; border-radius: 8px; text-decoration: none; color: #1e293b; border: 1px solid #e2e8f0; transition: all 0.2s;">
                        <div style="background: #dcfce7; color: #166534; padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px;">
                            <i class='bx bx-user-plus'></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">View All Patients</div>
                            <div style="color: #64748b; font-size: 0.8rem;">Access patient records</div>
                        </div>
                    </a>
                    <a href="/doctors/profile/" class="quick-action-btn" style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #fff; border-radius: 8px; text-decoration: none; color: #1e293b; border: 1px solid #e2e8f0; transition: all 0.2s;">
                        <div style="background: #f3e8ff; color: #7c3aed; padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px;">
                            <i class='bx bx-user-circle'></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Update Profile</div>
                            <div style="color: #64748b; font-size: 0.8rem;">Edit your information</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="dashboard-section" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0;">
        <h2 style="font-size: 1.25rem; font-weight: 700; color: #1e293b; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; font-size: 14px;">
                <i class='bx bx-bolt'></i>
            </div>
            Quick Actions
        </h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px;">
            <a href="/doctors/appointments/" style="text-decoration: none; background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; transition: all 0.3s ease; display: block;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; display: flex; align-items: center; justify-content: center;">
                        <i class='bx bx-calendar-check'></i>
                    </div>
                    <div style="font-weight: 600; color: #1e293b;">Manage Today's Schedule</div>
                </div>
                <div style="color: #64748b; font-size: 0.9rem;">Review and confirm appointments</div>
            </a>
            
            <a href="/doctors/patients/" style="text-decoration: none; background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; transition: all 0.3s ease; display: block;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #166534; display: flex; align-items: center; justify-content: center;">
                        <i class='bx bx-user-check'></i>
                    </div>
                    <div style="font-weight: 600; color: #1e293b;">Review Patient Records</div>
                </div>
                <div style="color: #64748b; font-size: 0.9rem;">Access patient files and AI predictions</div>
            </a>
            
            <a href="/doctors/availability/" style="text-decoration: none; background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; transition: all 0.3s ease; display: block;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #d97706; display: flex; align-items: center; justify-content: center;">
                        <i class='bx bx-time'></i>
                    </div>
                    <div style="font-weight: 600; color: #1e293b;">Update Availability</div>
                </div>
                <div style="color: #64748b; font-size: 0.9rem;">Modify your schedule and time slots</div>
            </a>
        </div>
    </div>
</div>

<div class="dashboard-section" style="margin-top:32px;">
    <div class="dashboard-header" style="font-size:1.5rem; margin-bottom:16px;">Doctor Availability</div>
    <div style="overflow-x:auto;">
        <table class="availability-table">
            <thead>
                <tr>
                    <th style="padding:10px;">Day</th>
                    <th style="padding:10px;">Start Time</th>
                    <th style="padding:10px;">End Time</th>
                    <th style="padding:10px;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for slot in availability %}
                <tr>
                    <td style="padding:10px;">{{ slot.get_weekday_display }}</td>
                    <td style="padding:10px;">{{ slot.start_time|time:"H:i" }}</td>
                    <td style="padding:10px;">{{ slot.end_time|time:"H:i" }}</td>
                    <td style="padding:10px;">{{ slot.is_active|yesno:"Available,Unavailable" }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align:center; padding:16px; color:#888;">No schedule set.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
