@startuml PMA_Sequence_Diagram
' Personalized Medical Assistant - UML Sequence Diagram
' Generated: November 7, 2025
' To use in draw.io: Arrange → Insert → Advanced → PlantUML

title Personalized Medical Assistant - Sequence Diagram\nPatient Medical Record Upload & ML Prediction Flow

skinparam backgroundColor #F8F9FA
skinparam sequence {
    ArrowColor #424242
    ArrowThickness 2
    ArrowFontSize 10
    ArrowFontColor #212121
    
    ActorBorderColor #424242
    ActorBorderThickness 2
    LifeLineBorderColor #757575
    LifeLineBorderThickness 2
    LifeLineBackgroundColor #ECEFF1
    
    ParticipantBorderColor #424242
    ParticipantBorderThickness 2
    
    ActorFontColor Black
    ActorFontSize 13
    ActorFontStyle bold
    
    ParticipantFontColor Black
    ParticipantFontSize 12
    ParticipantFontStyle bold
    
    BoxBorderColor #424242
    BoxFontSize 12
    BoxFontStyle bold
}

skinparam note {
    BackgroundColor #FFF9C4
    BorderColor #F57F17
    BorderThickness 2
    FontSize 10
}

' ============ Actors and Participants ============
actor Patient #90CAF9
participant "Web App\n(Django)" as WebApp #A5D6A7
participant "Auth Service\n(Django Auth)" as Auth #81C784
participant "ML Engine\n(Prediction)" as ML #CE93D8
database "MySQL\nDatabase" as DB #FFB74D
actor Doctor #66BB6A
participant "Notification\nService" as Notify #EF9A9A

' ============ Sequence Flow ============

== Authentication Phase ==
Patient -> WebApp: 1. Request login / appointment page
activate WebApp
WebApp -> Auth: 2. Authenticate user\n(username, password)
activate Auth
Auth -> DB: 3. Query user credentials
activate DB
DB --> Auth: 4. User data
deactivate DB
Auth --> WebApp: 5. Authentication token (JWT/Session)
deactivate Auth
WebApp --> Patient: 6. Redirect to dashboard
deactivate WebApp

== Medical Record Upload ==
Patient -> WebApp: 7. Upload medical record\n(file, description, record_type)
activate WebApp
WebApp -> DB: 8. Save MedicalRecord\n(patient_id, file, metadata)
activate DB
DB --> WebApp: 9. Record saved (record_id)
deactivate DB
WebApp --> Patient: 10. Upload confirmation
deactivate WebApp

== ML Prediction Trigger ==
Patient -> WebApp: 11. Request disease prediction\n(symptoms list)
activate WebApp
WebApp -> ML: 12. Trigger prediction\n(symptoms, patient_history)
activate ML

note right of ML
ML Engine analyzes:
- Input symptoms
- Patient medical history
- Historical data patterns
- Multiple ML models:
  * Random Forest
  * Enhanced Prediction
  * Dataset Overlap
end note

ML -> ML: 13. Process symptoms\nthrough prediction models
ML --> WebApp: 14. Prediction results\n(disease, confidence, recommendations)
deactivate ML

WebApp -> DB: 15. Save DiseasePrediction\n(patient_id, disease, confidence, medicines, diet)
activate DB
DB --> WebApp: 16. Prediction saved
deactivate DB

WebApp --> Patient: 17. Display prediction results\n(disease, confidence, recommendations)
deactivate WebApp

== Doctor Notification & Review ==
WebApp -> DB: 18. Find available doctor\n(specialization match)
activate WebApp
activate DB
DB --> WebApp: 19. Doctor profile
deactivate DB

WebApp -> Notify: 20. Send notification to doctor\n(new prediction, patient_id)
activate Notify
Notify --> Doctor: 21. Email/SMS notification
deactivate Notify

Doctor -> WebApp: 22. Login and review prediction
activate WebApp
WebApp -> DB: 23. Query prediction details
activate DB
DB --> WebApp: 24. Prediction & patient data
deactivate DB
WebApp --> Doctor: 25. Display patient details
deactivate WebApp

Doctor -> WebApp: 26. Add doctor notes\n& recommend follow-up
activate WebApp
WebApp -> DB: 27. Update DiseasePrediction\n(doctor_notes)
activate DB
DB --> WebApp: 28. Notes saved
deactivate DB
deactivate WebApp

== Patient Follow-up Notification ==
WebApp -> Notify: 29. Send follow-up notification\n(patient_id, doctor_notes)
activate WebApp
activate Notify
Notify --> Patient: 30. Email/SMS with doctor feedback
deactivate Notify

Patient -> WebApp: 31. Book appointment with doctor
activate WebApp
WebApp -> DB: 32. Create Appointment\n(patient_id, doctor_id, date, time)
activate DB
DB --> WebApp: 33. Appointment confirmed
deactivate DB
WebApp --> Patient: 34. Appointment confirmation
deactivate WebApp

== Alternative Flow: Low Confidence Prediction ==
note over ML, WebApp
**Alt: If confidence < threshold (e.g., 70%)**
- ML flags prediction for manual review
- Notification sent directly to specialist doctor
- Patient advised to consult doctor immediately
end note

@enduml
